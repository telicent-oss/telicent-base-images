#!/bin/bash
set -e

log() {
    echo "[INFO] $1"
}

log "Starting entrypoint script..."

if [ -f /etc/profile.d/pyenv.sh ]; then
    log "Sourcing Pyenv configuration..."
    source /etc/profile.d/pyenv.sh
else
    echo "[ERROR] Pyenv environment script not found. Exiting."
    exit 1
fi

if pyenv virtualenvs | grep -q "app"; then
    log "Activating virtual environment 'app'..."
    pyenv activate app || {
        echo "[ERROR] Failed to activate virtual environment 'app'. Exiting."
        exit 1
    }
else
    log "Virtual environment 'app' not found. Skipping activation."
fi

log "Executing the provided command or starting a shell..."
exec "$@"
